<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9&#xD;&#xA;                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
  <!--
    	See http://wiki.openmrs.org/display/docs/Module+liquibase+File for 
    	documentation on this file.
    
        See http://www.liquibase.org/manual/home#available_database_refactorings
        for a list of supported elements and attributes
    -->
  <changeSet author="dev" id="stockmanagement-1758855877841-1">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_batch" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_batch table
        </comment>
    <createTable tableName="stockmgmt_stock_batch">
      <column autoIncrement="true" name="stock_batch_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="stock_item_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="batch_no" type="VARCHAR(50)">
        <constraints nullable="false" />
      </column>
      <column name="expiration" type="DATE" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="date_voided" type="DATETIME" />
      <column name="voided_by" type="INT" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-2">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_item" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_item table
        </comment>
    <createTable tableName="stockmgmt_stock_item">
      <column autoIncrement="true" name="stock_item_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="drug_id" type="INT" />
      <column name="concept_id" type="INT" />
      <column defaultValueBoolean="false" name="has_expiration" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="preferred_vendor_id" type="INT" />
      <column name="purchase_price" type="DECIMAL(10,2)" />
      <column name="purchase_price_uom_id" type="INT" />
      <column name="dispensing_unit_id" type="INT" />
      <column name="dispensing_unit_packaging_uom_id" type="INT" />
      <column name="default_stock_operations_uom_id" type="INT" />
      <column name="common_name" type="VARCHAR(255)" />
      <column name="acronym" type="VARCHAR(255)" />
      <column name="is_drug" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="reorder_level" type="DECIMAL(10,2)" />
      <column name="reorder_level_uom_id" type="INT" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="date_voided" type="DATETIME" />
      <column name="voided_by" type="INT" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-3">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_item_packaging_uom" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_item_packaging_uom table
        </comment>
    <createTable tableName="stockmgmt_stock_item_packaging_uom">
      <column autoIncrement="true" name="stock_item_packaging_uom_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="stock_item_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="packaging_uom_id" type="INT" />
      <column name="factor" type="DECIMAL(10,2)" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="date_voided" type="DATETIME" />
      <column name="voided_by" type="INT" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-4">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_item_transaction" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_item_transaction table
        </comment>
    <createTable tableName="stockmgmt_stock_item_transaction">
      <column autoIncrement="true" name="stock_item_transaction_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="stock_operation_id" type="INT" />
      <column name="stock_operation_item_id" type="INT" />
      <column name="stock_item_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="stock_item_packaging_uom_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="quantity" type="DECIMAL(10,2)">
        <constraints nullable="false" />
      </column>
      <column name="stock_batch_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="party_id" type="INT" />
      <column name="patient_id" type="INT" />
      <column name="order_id" type="INT" />
      <column name="encounter_id" type="INT" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-5">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_reservation_transaction" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_reservation_transaction table
        </comment>
    <createTable tableName="stockmgmt_reservation_transaction">
      <column autoIncrement="true" name="stock_item_transaction_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="stock_operation_id" type="INT" />
      <column name="stock_operation_item_id" type="INT" />
      <column name="stock_item_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="stock_item_packaging_uom_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="quantity" type="DECIMAL(10,2)">
        <constraints nullable="false" />
      </column>
      <column name="stock_batch_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="party_id" type="INT" />
      <column name="patient_id" type="INT" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
      <column name="is_available" type="BIT" />
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-6">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_location_tree" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_location_tree table
        </comment>
    <createTable tableName="stockmgmt_location_tree">
      <column autoIncrement="true" name="stockmgmt_location_tree_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="parent_location_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="child_location_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="depth" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-7">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_operation" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_operation table
        </comment>
    <createTable tableName="stockmgmt_stock_operation">
      <column autoIncrement="true" name="stock_operation_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="operation_type_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="status" type="VARCHAR(50)">
        <constraints nullable="false" />
      </column>
      <column name="operation_date" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="operation_number" type="VARCHAR(255)">
      </column>
      <column name="external_reference" type="VARCHAR(50)" />
      <column name="remarks" type="VARCHAR(255)" />
      <column name="reason_id" type="INT" />
      <column name="at_location_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="source_id" type="INT" />
      <column name="destination_id" type="INT" />
      <column name="operation_order" type="INT" />
      <column defaultValueBoolean="false" name="locked" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="completed_by" type="INT" />
      <column name="completed_date" type="DATETIME" />
      <column name="cancelled_by" type="INT" />
      <column name="cancelled_date" type="DATETIME" />
      <column name="cancel_reason" type="VARCHAR(500)" />
      <column name="return_reason" type="VARCHAR(500)" />
      <column name="reject_reason" type="VARCHAR(500)" />
      <column name="approval_required" type="BIT" />
      <column name="responsible_person" type="INT" />
      <column name="responsible_person_other" type="VARCHAR(150)" />
      <column name="submitted_by" type="INT" />
      <column name="submitted_date" type="DATETIME" />
      <column name="dispatched_by" type="INT" />
      <column name="dispatched_date" type="DATETIME" />
      <column name="returned_by" type="INT" />
      <column name="returned_date" type="DATETIME" />
      <column name="rejected_by" type="INT" />
      <column name="rejected_date" type="DATETIME" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-8">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_operation_link" />
      </not>
    </preConditions>
    <comment>
      Creating the stockmgmt_stock_operation_link table
    </comment>
    <createTable tableName="stockmgmt_stock_operation_link">
      <column autoIncrement="true" name="stock_operation_link_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="parent_stock_operation_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="child_stock_operation_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-9">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_operation_item" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_operation_item table
        </comment>
    <createTable tableName="stockmgmt_stock_operation_item">
      <column autoIncrement="true" name="stock_operation_item_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="stock_operation_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="stock_item_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="stock_item_packaging_uom_id" type="INT" />
      <column name="quantity" type="DECIMAL(10,2)" />
      <column name="purchase_price" type="DECIMAL(10,2)" />
      <column name="stock_batch_id" type="INT">
      </column>
      <column name="qty_rcvd_packaging_uom_id" type="INT" />
      <column name="quantity_received" type="DECIMAL(10,2)" />
      <column name="quantity_requested" type="DECIMAL(10,2)" />
      <column name="qty_req_packaging_uom_id" type="INT" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="date_voided" type="DATETIME" />
      <column name="voided_by" type="INT" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-10">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_operation_type" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_operation_type table
        </comment>
    <createTable tableName="stockmgmt_stock_operation_type">
      <column autoIncrement="true" name="stock_operation_type_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column defaultValue="" name="name" type="VARCHAR(255)">
        <constraints nullable="false" />
      </column>
      <column defaultValue="" name="description" type="VARCHAR(1024)" />
      <column name="operation_type" type="VARCHAR(255)">
        <constraints nullable="false" />
      </column>
      <column name="has_source" type="BIT" />
      <column name="source_type" type="VARCHAR(50)" />
      <column name="has_destination" type="BIT" />
      <column name="destination_type" type="VARCHAR(50)" />
      <column name="acronym" type="VARCHAR(10)" />
      <column name="available_when_reserved" type="BIT" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-11" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_rule" />
      </not>
    </preConditions>
    <comment>Creating the stockmgmt_stock_rule table</comment>
    <createTable tableName="stockmgmt_stock_rule">
      <column autoIncrement="true" name="stock_rule_id" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="stockmgmt_stock_rule_pk" />
      </column>
      <column name="stock_item_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="name" type="VARCHAR(255)">
        <constraints nullable="false" />
      </column>
      <column name="description" type="VARCHAR(500)" />
      <column name="location_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="quantity" type="DECIMAL(10,2)" />
      <column name="stock_item_packaging_uom_id" type="INT" />
      <column name="enabled" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="evaluation_frequency" type="BIGINT">
        <constraints nullable="false" />
      </column>
      <column name="last_evaluation" type="DATETIME" />
      <column name="next_evaluation" type="DATETIME" />
      <column name="action_frequency" type="BIGINT">
        <constraints nullable="false" />
      </column>
      <column name="alert_priviledge" type="VARCHAR(255)" />
      <column name="mail_priviledge" type="VARCHAR(255)" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-12" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_user_role_scope" />
      </not>
    </preConditions>
    <comment>Creating the stockmgmt_user_role_scope table</comment>
    <createTable tableName="stockmgmt_user_role_scope">
      <column autoIncrement="true" name="user_role_scope_id" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="stockmgmt_user_role_scope_pk" />
      </column>
      <column name="user_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="role" type="VARCHAR(50)">
        <constraints nullable="false" />
      </column>
      <column name="is_permanent" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="active_from" type="DATETIME" />
      <column name="active_to" type="DATETIME" />
      <column name="enabled" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-13" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_user_role_scope_location" />
      </not>
    </preConditions>
    <comment>Creating the stockmgmt_user_role_scope_location table</comment>
    <createTable tableName="stockmgmt_user_role_scope_location">
      <column autoIncrement="true" name="user_role_scope_location_id" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="stockmgmt_user_role_scope_location_pk" />
      </column>
      <column name="user_role_scope_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="location_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="enable_descendants" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-14" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_user_role_scope_operation_type" />
      </not>
    </preConditions>
    <comment>Creating the stockmgmt_user_role_scope_operation_type table</comment>
    <createTable tableName="stockmgmt_user_role_scope_operation_type">
      <column autoIncrement="true" name="user_role_scope_operation_type_id" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="stockmgmt_user_role_scope_operation_type_pk" />
      </column>
      <column name="user_role_scope_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="operation_type_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-15" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_party" />
      </not>
    </preConditions>
    <comment>Creating the stockmgmt_party table</comment>
    <createTable tableName="stockmgmt_party">
      <column autoIncrement="true" name="party_id" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="stockmgmt_party_pk" />
      </column>
      <column name="location_id" type="INT" />
      <column name="stock_source_id" type="INT" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-16" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_operation_type_location_scope" />
      </not>
    </preConditions>
    <comment>Creating the stockmgmt_operation_type_location_scope table</comment>
    <createTable tableName="stockmgmt_operation_type_location_scope">
      <column autoIncrement="true" name="stock_operation_type_location_scope_id" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="stockmgmt_operation_type_location_scope_pk" />
      </column>
      <column name="stock_operation_type_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="location_tag" type="VARCHAR(50)">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="is_source" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="is_destination" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-17">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_stock_source" />
      </not>
    </preConditions>
    <comment>
            Creating the stockmgmt_stock_source table
        </comment>
    <createTable tableName="stockmgmt_stock_source">
      <column autoIncrement="true" name="stock_source_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="name" type="VARCHAR(255)">
        <constraints nullable="false" />
      </column>
      <column name="acronym" type="VARCHAR(255)">
        <constraints nullable="false" />
      </column>
      <column name="source_type_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="voided_by" type="INT" />
      <column name="date_voided" type="DATETIME" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-18">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_operation_type_location_scope_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_operation_type_location_scope_creator_fk" tableName="stockmgmt_operation_type_location_scope" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-19">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_operation_type_location_scope_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_operation_type_location_scope_changed_by_fk" tableName="stockmgmt_operation_type_location_scope" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-20">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_operation_type_location_scope_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_operation_type_location_scope_voided_by_fk" tableName="stockmgmt_operation_type_location_scope" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-21">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_operation_type_location_scope" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-22">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_party_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_party_creator_fk" tableName="stockmgmt_party" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-23">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_party_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_party_changed_by_fk" tableName="stockmgmt_party" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-24">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_party_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_party_voided_by_fk" tableName="stockmgmt_party" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-25">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_party" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-26">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_party_location_source_uk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_party_location_source_uk" tableName="stockmgmt_party" unique="true">
      <column name="location_id" />
      <column name="stock_source_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-27">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stock_item_batch_no_expiration" />
      </not>
    </preConditions>
    <createIndex indexName="stock_item_batch_no_expiration" tableName="stockmgmt_stock_batch" unique="true">
      <column name="stock_item_id" />
      <column name="batch_no" />
      <column name="expiration" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-28">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_batch_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_batch_changed_by_fk" tableName="stockmgmt_stock_batch" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-29">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_batch_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_batch_creator_fk" tableName="stockmgmt_stock_batch" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-30">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_batch_stock_item_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_batch_stock_item_fk" tableName="stockmgmt_stock_batch" unique="false">
      <column name="stock_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-31">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_batch_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_batch_voided_by_fk" tableName="stockmgmt_stock_batch" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-32">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_batch" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-33">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="drug_id_concept_id_index" />
      </not>
    </preConditions>
    <createIndex indexName="drug_id_concept_id_index" tableName="stockmgmt_stock_item" unique="true">
      <column name="drug_id" />
      <column name="concept_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-34">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_changed_by_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-35">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_concept_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_concept_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="concept_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-36">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_creator_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-37">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_drug_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_drug_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="drug_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-38">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_preferred_vendor_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_preferred_vendor_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="preferred_vendor_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-39">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_purchase_price_uom_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_purchase_price_uom_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="purchase_price_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-40">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_df_stock_operations_uom_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_df_stock_operations_uom_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="default_stock_operations_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-41">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_reorder_level_uom_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_reorder_level_uom_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="reorder_level_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-42">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_du_packaging_uom_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_du_packaging_uom_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="dispensing_unit_packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-43">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_dispensing_unit_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_dispensing_unit_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="dispensing_unit_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-44">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_voided_by_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-45">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_item" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-46">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_packaging_uom_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_packaging_uom_changed_by_fk" tableName="stockmgmt_stock_item_packaging_uom" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-47">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_packaging_uom_concept_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_packaging_uom_concept_fk" tableName="stockmgmt_stock_item_packaging_uom" unique="false">
      <column name="packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-48">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_packaging_uom_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_packaging_uom_creator_fk" tableName="stockmgmt_stock_item_packaging_uom" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-49">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_packaging_uom_stock_item_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_packaging_uom_stock_item_fk" tableName="stockmgmt_stock_item_packaging_uom" unique="false">
      <column name="stock_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-50">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_packaging_uom_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_packaging_uom_voided_by_fk" tableName="stockmgmt_stock_item_packaging_uom" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-51">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_item_packaging_uom" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-52">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_batch_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_batch_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="stock_batch_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-53">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_creator_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-54">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_item_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_item_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="stock_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-55">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_operation_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_operation_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="stock_operation_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-56">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_soi_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_soi_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="stock_operation_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-57">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_packaging_uom_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_packaging_uom_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="stock_item_packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-58">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_party_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_party_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="party_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-59">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_patient_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_patient_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="patient_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-60">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_order_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_order_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="order_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-61">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_encounter_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_encounter_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="encounter_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-62">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_itemsearch_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_itemsearch_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="party_id" />
      <column name="stock_item_id" />
      <column name="stock_batch_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-63">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_item_transaction" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-64">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_batch_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_batch_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="stock_batch_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-65">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_creator_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-66">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_item_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_item_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="stock_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-67">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_operation_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_operation_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="stock_operation_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-68">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_soi_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_soi_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="stock_operation_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-69">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_packaging_uom_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_packaging_uom_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="stock_item_packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-70">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_party_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_party_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="party_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-71">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_reservation_transaction_patient_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_reservation_transaction_patient_fk" tableName="stockmgmt_reservation_transaction" unique="false">
      <column name="patient_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-72">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_reservation_transaction" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-73">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_cancelled_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_cancelled_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="cancelled_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-74">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_changed_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-75">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_completed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_completed_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="completed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-76">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_submitted_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_submitted_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="submitted_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-77">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_dispatched_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_dispatched_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="dispatched_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-78">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_returned_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_returned_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="returned_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-79">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_rejected_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_rejected_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="rejected_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-80">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_creator_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-81">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_destination_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_destination_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="destination_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-82">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_location_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_location_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="at_location_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-83">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_reason_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_reason_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="reason_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-84">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_source_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_source_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="source_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-85">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_voided_by_fk" tableName="stockmgmt_stock_operation" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-86">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_operation" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-87">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_item_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_item_creator_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-88">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_item_batch_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_item_batch_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="stock_batch_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-89">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_item_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_item_changed_by_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-90">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_item_packaging_uom_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_item_packaging_uom_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="stock_item_packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-91">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_oi_qty_rcvd_pkg_uom_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_oi_qty_rcvd_pkg_uom_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="qty_rcvd_packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-92">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_oi_qty_req_pkg_uom_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_oi_qty_req_pkg_uom_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="qty_req_packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-93">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_item_stock_item_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_item_stock_item_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="stock_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-94">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_item_stock_operation_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_item_stock_operation_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="stock_operation_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-95">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_item_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_item_voided_by_fk" tableName="stockmgmt_stock_operation_item" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-96">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_operation_item" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-97">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_type_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_type_changed_by_fk" tableName="stockmgmt_stock_operation_type" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-98">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_type_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_type_creator_fk" tableName="stockmgmt_stock_operation_type" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-99">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_type_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_type_voided_by_fk" tableName="stockmgmt_stock_operation_type" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-100">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_operation_type" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-101">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_link_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_link_creator_fk" tableName="stockmgmt_stock_operation_link" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-102">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_link_pso_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_link_pso_fk" tableName="stockmgmt_stock_operation_link" unique="false">
      <column name="parent_stock_operation_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-103">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_link_cso_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_link_cso_fk" tableName="stockmgmt_stock_operation_link" unique="false">
      <column name="child_stock_operation_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-104">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_link_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_link_changed_by_fk" tableName="stockmgmt_stock_operation_link" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-105">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_operation_link_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_operation_link_voided_by_fk" tableName="stockmgmt_stock_operation_link" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-106">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_operation_link" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <!-- Stock Source -->
  <changeSet author="dev" id="stockmanagement-1758855877841-107">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_source_type_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_source_type_fk" tableName="stockmgmt_stock_source" unique="false">
      <column name="source_type_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-108">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_source_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_source_changed_by_fk" tableName="stockmgmt_stock_source" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-109">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_source_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_source_creator_fk" tableName="stockmgmt_stock_source" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-110">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_source_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_source_voided_by_fk" tableName="stockmgmt_stock_source" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-111">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_source" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-112">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_rule_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_rule_creator_fk" tableName="stockmgmt_stock_rule" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-113">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_rule_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_rule_changed_by_fk" tableName="stockmgmt_stock_rule" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-114">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_rule_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_rule_voided_by_fk" tableName="stockmgmt_stock_rule" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-115">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_stock_rule" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-116">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_creator_fk" tableName="stockmgmt_user_role_scope" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-117">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_changed_by_fk" tableName="stockmgmt_user_role_scope" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-118">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_voided_by_fk" tableName="stockmgmt_user_role_scope" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-119">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_user_role_scope" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-120">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_location_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_location_creator_fk" tableName="stockmgmt_user_role_scope_location" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-121">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_location_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_location_changed_by_fk" tableName="stockmgmt_user_role_scope_location" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-122">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_location_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_location_voided_by_fk" tableName="stockmgmt_user_role_scope_location" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-123">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_user_role_scope_location" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-124">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_operation_type_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_operation_type_creator_fk" tableName="stockmgmt_user_role_scope_operation_type" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-125">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_operation_type_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_operation_type_changed_by_fk" tableName="stockmgmt_user_role_scope_operation_type" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-126">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_user_role_scope_operation_type_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_user_role_scope_operation_type_voided_by_fk" tableName="stockmgmt_user_role_scope_operation_type" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-127">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_user_role_scope_operation_type" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-128">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_batch_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_batch" constraintName="stockmgmt_stock_batch_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-129">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_batch_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_batch" constraintName="stockmgmt_stock_batch_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-130">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_batch_stock_item_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_id" baseTableName="stockmgmt_stock_batch" constraintName="stockmgmt_stock_batch_stock_item_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_id" referencedTableName="stockmgmt_stock_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-131">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_batch_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_batch" constraintName="stockmgmt_stock_batch_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-132">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-133">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_concept_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="concept_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_concept_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="concept_id" referencedTableName="concept" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-134">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_preferred_vendor_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="preferred_vendor_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_preferred_vendor_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_source_id" referencedTableName="stockmgmt_stock_source" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-135">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_purchase_price_uom_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="purchase_price_uom_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_purchase_price_uom_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-136">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_df_stock_operations_uom_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="default_stock_operations_uom_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_df_stock_operations_uom_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-137">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_reorder_level_uom_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="reorder_level_uom_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_reorder_level_uom_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-138">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_du_packaging_uom_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="dispensing_unit_packaging_uom_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_du_packaging_uom_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-139">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_dispensing_unit_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="dispensing_unit_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_dispensing_unit_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="concept_id" referencedTableName="concept" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-140">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_so_responsible_person_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="responsible_person" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_so_responsible_person_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-141">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-142">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_drug_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="drug_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_drug_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="drug_id" referencedTableName="drug" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-143">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_packaging_uom_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_item_packaging_uom" constraintName="stockmgmt_stock_item_packaging_uom_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-144">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_packaging_uom_concept_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="packaging_uom_id" baseTableName="stockmgmt_stock_item_packaging_uom" constraintName="stockmgmt_stock_item_packaging_uom_concept_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="concept_id" referencedTableName="concept" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-145">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_packaging_uom_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_item_packaging_uom" constraintName="stockmgmt_stock_item_packaging_uom_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-146">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_packaging_uom_stock_item_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_id" baseTableName="stockmgmt_stock_item_packaging_uom" constraintName="stockmgmt_stock_item_packaging_uom_stock_item_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_id" referencedTableName="stockmgmt_stock_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-147">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_packaging_uom_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_item_packaging_uom" constraintName="stockmgmt_stock_item_packaging_uom_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-148">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_batch_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_batch_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_batch_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_batch_id" referencedTableName="stockmgmt_stock_batch" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-149">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-150">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_item_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_item_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_id" referencedTableName="stockmgmt_stock_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-151">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_operation_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_operation_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_operation_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_id" referencedTableName="stockmgmt_stock_operation" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-152">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_soi_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_operation_item_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_soi_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_item_id" referencedTableName="stockmgmt_stock_operation_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-153">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_packaging_uom_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_packaging_uom_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_packaging_uom_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-154">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_party_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="party_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_party_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="party_id" referencedTableName="stockmgmt_party" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-155">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_patient_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="patient_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_patient_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="patient_id" referencedTableName="patient" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-156">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_order_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="order_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_order_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="order_id" referencedTableName="drug_order" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-157">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_transaction_encounter_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="encounter_id" baseTableName="stockmgmt_stock_item_transaction" constraintName="stockmgmt_stock_item_transaction_encounter_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="encounter_id" referencedTableName="encounter" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-158">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_batch_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_batch_id" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_batch_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_batch_id" referencedTableName="stockmgmt_stock_batch" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-159">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-160">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_item_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_id" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_item_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_id" referencedTableName="stockmgmt_stock_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-161">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_operation_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_operation_id" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_operation_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_id" referencedTableName="stockmgmt_stock_operation" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-162">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_soi_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_operation_item_id" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_soi_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_item_id" referencedTableName="stockmgmt_stock_operation_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-163">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_packaging_uom_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_packaging_uom_id" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_packaging_uom_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-164">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_party_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="party_id" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_party_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="party_id" referencedTableName="stockmgmt_party" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-165">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_reservation_transaction_patient_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="patient_id" baseTableName="stockmgmt_reservation_transaction" constraintName="stockmgmt_reservation_transaction_patient_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="patient_id" referencedTableName="patient" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-166">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-167">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_cancelled_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="cancelled_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_cancelled_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-168">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-169">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_completed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="completed_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_completed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-170">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_submitted_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="submitted_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_submitted_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-171">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_dispatched_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="dispatched_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_dispatched_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-172">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_returned_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="returned_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_returned_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-173">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_rejected_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="rejected_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_rejected_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-174">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-175">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_destination_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="destination_id" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_destination_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="party_id" referencedTableName="stockmgmt_party" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-176">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_item_batch_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_batch_id" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_operation_item_batch_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_batch_id" referencedTableName="stockmgmt_stock_batch" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-177">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_item_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_operation_item_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-178">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_item_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_operation_item_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-179">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_item_packaging_uom_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_packaging_uom_id" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_operation_item_packaging_uom_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-180">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_oi_qty_rcvd_pkg_uom_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="qty_rcvd_packaging_uom_id" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_oi_qty_rcvd_pkg_uom_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-181">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_oi_qty_req_pkg_uom_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="qty_req_packaging_uom_id" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_oi_qty_req_pkg_uom_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-182">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_item_stock_item_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_id" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_operation_item_stock_item_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_id" referencedTableName="stockmgmt_stock_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-183">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_item_stock_op_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_operation_id" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_operation_item_stock_op_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_id" referencedTableName="stockmgmt_stock_operation" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-184">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_item_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_operation_item" constraintName="stockmgmt_stock_operation_item_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-185">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_link_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_operation_link" constraintName="stockmgmt_stock_operation_link_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-186">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_link_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_operation_link" constraintName="stockmgmt_stock_operation_link_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-187">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_link_pso_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="parent_stock_operation_id" baseTableName="stockmgmt_stock_operation_link" constraintName="stockmgmt_stock_operation_link_pso_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_id" referencedTableName="stockmgmt_stock_operation" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-188">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_link_cso_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="child_stock_operation_id" baseTableName="stockmgmt_stock_operation_link" constraintName="stockmgmt_stock_operation_link_cso_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_id" referencedTableName="stockmgmt_stock_operation" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-189">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_link_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_operation_link" constraintName="stockmgmt_stock_operation_link_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-190">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_location_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="at_location_id" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_location_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="location_id" referencedTableName="location" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-191">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_reason_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="reason_id" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_reason_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="concept_id" referencedTableName="concept" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-192">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_operation_type_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="operation_type_id" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_operation_type_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_operation_type_id" referencedTableName="stockmgmt_stock_operation_type" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-193">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_source_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="source_id" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_source_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="party_id" referencedTableName="stockmgmt_party" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-194">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_type_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_operation_type" constraintName="stockmgmt_stock_operation_type_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-195">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_type_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_operation_type" constraintName="stockmgmt_stock_operation_type_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-196">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_type_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_operation_type" constraintName="stockmgmt_stock_operation_type_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <!-- Stock Source -->
  <changeSet author="dev" id="stockmanagement-1758855877841-197">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_source_type_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="source_type_id" baseTableName="stockmgmt_stock_source" constraintName="stockmgmt_stock_source_type_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="concept_id" referencedTableName="concept" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-198">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_source_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_source" constraintName="stockmgmt_stock_source_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-199">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_source_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_source" constraintName="stockmgmt_stock_source_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-200">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_source_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_source" constraintName="stockmgmt_stock_source_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-201">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_operation_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_operation" constraintName="stockmgmt_stock_operation_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-202">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_rule_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_stock_rule" constraintName="stockmgmt_stock_rule_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-203">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_rule_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_stock_rule" constraintName="stockmgmt_stock_rule_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-204">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_rule_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_stock_rule" constraintName="stockmgmt_stock_rule_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-205">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_user_role_scope" constraintName="stockmgmt_user_role_scope_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-206">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_user_role_scope" constraintName="stockmgmt_user_role_scope_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-207">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_user_role_scope" constraintName="stockmgmt_user_role_scope_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-208">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_location_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_user_role_scope_location" constraintName="stockmgmt_user_role_scope_location_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-209">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_location_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_user_role_scope_location" constraintName="stockmgmt_user_role_scope_location_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-210">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_location_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_user_role_scope_location" constraintName="stockmgmt_user_role_scope_location_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-211">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_operation_type_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_user_role_scope_operation_type" constraintName="stockmgmt_user_role_scope_operation_type_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-212">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_operation_type_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_user_role_scope_operation_type" constraintName="stockmgmt_user_role_scope_operation_type_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-213">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_operation_type_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_user_role_scope_operation_type" constraintName="stockmgmt_user_role_scope_operation_type_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-214" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_rule_on_stock_item_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_id" baseTableName="stockmgmt_stock_rule" constraintName="stockmgmt_stock_rule_on_stock_item_fk" referencedColumnNames="stock_item_id" referencedTableName="stockmgmt_stock_item" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-215" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_rule_on_stock_item_packaging_uom_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_packaging_uom_id" baseTableName="stockmgmt_stock_rule" constraintName="stockmgmt_stock_rule_on_stock_item_packaging_uom_fk" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-216" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_rule_on_location_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="stockmgmt_stock_rule" constraintName="stockmgmt_stock_rule_on_location_fk" referencedColumnNames="location_id" referencedTableName="location" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-217">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_user_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="stockmgmt_user_role_scope" constraintName="stockmgmt_user_role_scope_user_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-218" failOnError="false">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_role_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="role" baseTableName="stockmgmt_user_role_scope" constraintName="stockmgmt_user_role_scope_role_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="role" referencedTableName="role" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-219" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_location_on_user_role_scope_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="user_role_scope_id" baseTableName="stockmgmt_user_role_scope_location" constraintName="stockmgmt_user_role_scope_location_on_user_role_scope_fk" referencedColumnNames="user_role_scope_id" referencedTableName="stockmgmt_user_role_scope" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-220" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_operation_type_on_operation_type_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="operation_type_id" baseTableName="stockmgmt_user_role_scope_operation_type" constraintName="stockmgmt_user_role_scope_operation_type_on_operation_type_fk" referencedColumnNames="stock_operation_type_id" referencedTableName="stockmgmt_stock_operation_type" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-221" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_user_role_scope_operation_type_on_user_role_scope_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="user_role_scope_id" baseTableName="stockmgmt_user_role_scope_operation_type" constraintName="stockmgmt_user_role_scope_operation_type_on_user_role_scope_fk" referencedColumnNames="user_role_scope_id" referencedTableName="stockmgmt_user_role_scope" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-222" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_operation_type_loc_scope_on_operation_type_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_operation_type_id" baseTableName="stockmgmt_operation_type_location_scope" constraintName="stockmgmt_operation_type_loc_scope_on_operation_type_fk" referencedColumnNames="stock_operation_type_id" referencedTableName="stockmgmt_stock_operation_type" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-223" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_party_location_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="stockmgmt_party" constraintName="stockmgmt_party_location_fk" referencedColumnNames="location_id" referencedTableName="location" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-224" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_party_stock_source_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_source_id" baseTableName="stockmgmt_party" constraintName="stockmgmt_party_stock_source_fk" referencedColumnNames="stock_source_id" referencedTableName="stockmgmt_stock_source" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-225" author="dev">
    <preConditions onFail="MARK_RAN">
      <dbms type="mysql" />
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_after_insert on location table
        </comment>
    <sql splitStatements="true" endDelimiter="\$\$"><![CDATA[
DROP TRIGGER IF EXISTS `stockmgmt_location_after_insert`;
$$
CREATE TRIGGER `stockmgmt_location_after_insert` AFTER INSERT ON `location`
FOR EACH ROW
BEGIN
	INSERT INTO stockmgmt_location_tree (parent_location_id, child_location_id, depth, uuid)
    VALUES (NEW.location_id, NEW.location_id, 0, uuid());

	INSERT INTO stockmgmt_location_tree (parent_location_id, child_location_id, depth, uuid)
    SELECT x.parent_location_id, NEW.location_id, x.depth + 1, uuid()
    FROM stockmgmt_location_tree x
    WHERE x.child_location_id = NEW.parent_location;

    INSERT INTO stockmgmt_party(location_id, creator, date_created, uuid)
    VALUES(NEW.location_id,NEW.creator, NEW.date_created, uuid());
END
$$
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS `stockmgmt_location_after_insert`;
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-226" author="dev">
    <preConditions onFail="CONTINUE">
      <dbms type="postgresql" />
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_after_insert on location table
        </comment>
    <sql><![CDATA[
DROP TRIGGER IF EXISTS stockmgmt_location_after_insert ON location;

DROP FUNCTION IF EXISTS stockmgmt_location_after_insert();

CREATE OR REPLACE FUNCTION stockmgmt_location_after_insert()
    RETURNS trigger
    LANGUAGE 'plpgsql'
AS $BODY$

DECLARE

BEGIN

    INSERT INTO stockmgmt_location_tree (parent_location_id, child_location_id, depth, uuid) VALUES (NEW.location_id, NEW.location_id, 0,uuid_generate_v4());
    INSERT INTO stockmgmt_location_tree (parent_location_id, child_location_id, depth, uuid) SELECT x.parent_location_id, NEW.location_id, x.depth + 1,uuid_generate_v4() FROM stockmgmt_location_tree x WHERE x.child_location_id = NEW.parent_location;
    INSERT INTO stockmgmt_party(location_id, creator, date_created, uuid) VALUES(NEW.location_id,NEW.creator, NEW.date_created, uuid_generate_v4());

    RETURN NEW;

END;

$BODY$;

CREATE TRIGGER stockmgmt_location_after_insert
    AFTER INSERT
    ON location
    FOR EACH ROW
    EXECUTE FUNCTION stockmgmt_location_after_insert();
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS stockmgmt_location_after_insert ON location;
            DROP FUNCTION IF EXISTS stockmgmt_location_after_insert();
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-227" author="dev">
    <preConditions onFail="MARK_RAN">
      <dbms type="mysql" />
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_before_update on location table
        </comment>
    <sql splitStatements="true" endDelimiter="\$\$"><![CDATA[
DROP TRIGGER IF EXISTS `stockmgmt_location_before_update`;
$$
CREATE TRIGGER `stockmgmt_location_before_update` BEFORE UPDATE ON `location` FOR EACH ROW
BEGIN
	IF (NEW.location_id <> OLD.location_id) THEN
		SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Changing ids is forbidden';
	END IF;
    IF (NEW.parent_location IS NOT NULL AND (OLD.parent_location <> NEW.parent_location OR  OLD.parent_location IS NULL)) THEN
		IF EXISTS(SELECT 1 FROM stockmgmt_location_tree WHERE (parent_location_id = NEW.location_id) AND (child_location_id = NEW.parent_location))=1 THEN
			SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Update blocked because it would create loop in tree';
		END IF;

    END IF;
END
$$
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS `stockmgmt_location_before_update`;
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-228" author="dev">
    <preConditions onFail="MARK_RAN">
      <and>
        <dbms type="postgresql" />
      </and>
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_before_update on location table
        </comment>
    <sql><![CDATA[
DROP TRIGGER IF EXISTS stockmgmt_location_before_update ON location;

DROP FUNCTION IF EXISTS stockmgmt_location_before_update();

CREATE OR REPLACE FUNCTION stockmgmt_location_before_update()
    RETURNS trigger
    LANGUAGE 'plpgsql'
AS $BODY$

DECLARE

BEGIN

    IF NEW.location_id <> OLD.location_id THEN

        RAISE EXCEPTION 'Changing ids is forbidden.';

    END IF;

    IF NOT OLD.parent_location IS DISTINCT FROM NEW.parent_location THEN

        RETURN NEW;

    END IF;

    IF NEW.parent_location IS NULL THEN

        RETURN NEW;

    END IF;

    PERFORM 1 FROM stockmgmt_location_tree WHERE ( parent_location_id, child_location_id ) = ( NEW.location_id, NEW.parent_location );

    IF FOUND THEN

        RAISE EXCEPTION 'Update blocked, because it would create loop in tree.';

    END IF;

    RETURN NEW;

END;

$BODY$;

CREATE TRIGGER stockmgmt_location_before_update
    BEFORE UPDATE
    ON public.location
    FOR EACH ROW
    EXECUTE FUNCTION public.stockmgmt_location_before_update();
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS stockmgmt_location_before_update ON location;
            DROP FUNCTION IF EXISTS stockmgmt_location_before_update();
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-229" author="dev">
    <preConditions onFail="MARK_RAN">
      <dbms type="mysql" />
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_after_update on location table
        </comment>
    <sql splitStatements="true" endDelimiter="\$\$"><![CDATA[
DROP TRIGGER IF EXISTS `stockmgmt_location_after_update`;
$$
CREATE TRIGGER `stockmgmt_location_after_update` AFTER UPDATE ON `location`
FOR EACH ROW
BEGIN
	IF  ((OLD.parent_location IS NULL AND NEW.parent_location IS NOT NULL) OR (OLD.parent_location IS NOT NULL AND NEW.parent_location IS NULL) OR (OLD.parent_location IS NOT NULL AND NEW.parent_location IS NOT NULL AND OLD.parent_location <> NEW.parent_location)) THEN
		IF OLD.parent_location IS NOT NULL THEN
			DELETE FROM stockmgmt_location_tree WHERE stockmgmt_location_tree_id in (
				SELECT stockmgmt_location_tree_id FROM (
				SELECT  distinct  r2.stockmgmt_location_tree_id
				FROM stockmgmt_location_tree r1
				JOIN stockmgmt_location_tree r2 on r1.child_location_id = r2.child_location_id
				WHERE r1.parent_location_id = NEW.location_id AND r2.depth > r1.depth
                ) ids_to_delete
			);
		END IF;
		IF NEW.parent_location IS NOT NULL THEN
			INSERT INTO stockmgmt_location_tree (parent_location_id, child_location_id, depth, uuid)
			SELECT r1.parent_location_id, r2.child_location_id, r1.depth + r2.depth + 1, uuid()
			FROM stockmgmt_location_tree r1, stockmgmt_location_tree r2
			WHERE r1.child_location_id = NEW.parent_location AND
				r2.parent_location_id = NEW.location_id;
		END IF;
    END IF;
END
$$
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS `stockmgmt_location_after_update`;
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-230" author="dev">
    <preConditions onFail="MARK_RAN">
      <and>
        <dbms type="postgresql" />
      </and>
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_after_update on location table
        </comment>
    <sql><![CDATA[
DROP TRIGGER IF EXISTS stockmgmt_location_after_update ON location;

DROP FUNCTION IF EXISTS stockmgmt_location_after_update();

CREATE OR REPLACE FUNCTION stockmgmt_location_after_update()
    RETURNS trigger
    LANGUAGE 'plpgsql'
AS $BODY$

DECLARE

BEGIN

    IF NOT OLD.parent_location IS DISTINCT FROM NEW.parent_location THEN

        RETURN NEW;

    END IF;

    IF OLD.parent_location IS NOT NULL THEN

        DELETE FROM stockmgmt_location_tree WHERE stockmgmt_location_tree_id in (

            SELECT r2.stockmgmt_location_tree_id FROM stockmgmt_location_tree r1 join stockmgmt_location_tree r2 on r1.child_location_id = r2.child_location_id

            WHERE r1.parent_location_id = NEW.location_id AND r2.depth > r1.depth

        );

    END IF;

    IF NEW.parent_location IS NOT NULL THEN

        INSERT INTO stockmgmt_location_tree (parent_location_id, child_location_id, depth, uuid)

            SELECT r1.parent_location_id, r2.child_location_id, r1.depth + r2.depth + 1, uuid_generate_v4()

        FROM

            stockmgmt_location_tree r1,

            stockmgmt_location_tree r2

        WHERE

            r1.child_location_id = NEW.parent_location AND

            r2.parent_location_id = NEW.location_id;

    END IF;

    RETURN NEW;

END;

$BODY$;

CREATE TRIGGER stockmgmt_location_after_update
    AFTER UPDATE
    ON public.location
    FOR EACH ROW
    EXECUTE FUNCTION stockmgmt_location_after_update();
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS stockmgmt_location_after_update ON location;
            DROP FUNCTION IF EXISTS stockmgmt_location_after_update();
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-231" author="dev">
    <preConditions onFail="MARK_RAN">
      <dbms type="mysql" />
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_after_delete on location table
        </comment>
    <sql splitStatements="true" endDelimiter="\$\$"><![CDATA[
DROP TRIGGER IF EXISTS `stockmgmt_location_after_delete`;
$$
CREATE TRIGGER `stockmgmt_location_after_delete` AFTER DELETE ON `location` FOR EACH ROW
BEGIN
	DELETE FROM stockmgmt_location_tree WHERE stockmgmt_location_tree_id in (
    SELECT stockmgmt_location_tree_id FROM (
		SELECT  distinct r2.stockmgmt_location_tree_id
		FROM stockmgmt_location_tree r1
		JOIN stockmgmt_location_tree r2 on r1.child_location_id = r2.child_location_id
		WHERE r1.parent_location_id = OLD.location_id) as ids_to_delete);

END
$$
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS `stockmgmt_location_after_delete`;
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-232" author="dev">
    <preConditions onFail="MARK_RAN">
      <and>
        <dbms type="postgresql" />
      </and>
    </preConditions>
    <comment>
            Creating trigger stockmgmt_location_after_delete on location table
        </comment>
    <sql><![CDATA[
DROP TRIGGER IF EXISTS stockmgmt_location_after_delete ON location;

DROP FUNCTION IF EXISTS stockmgmt_location_after_delete();

CREATE OR REPLACE FUNCTION stockmgmt_location_after_delete()
    RETURNS trigger
    LANGUAGE 'plpgsql'
AS $BODY$

DECLARE

BEGIN
	DELETE FROM stockmgmt_location_tree WHERE stockmgmt_location_tree_id in (
    SELECT stockmgmt_location_tree_id FROM (
		SELECT  distinct r2.stockmgmt_location_tree_id
		FROM stockmgmt_location_tree r1
		JOIN stockmgmt_location_tree r2 on r1.child_location_id = r2.child_location_id
		WHERE r1.parent_location_id = OLD.location_id) as ids_to_delete);

    RETURN NEW;

END;

$BODY$;

CREATE TRIGGER stockmgmt_location_after_delete
    AFTER DELETE
    ON public.location
    FOR EACH ROW
    EXECUTE FUNCTION stockmgmt_location_after_delete();
            ]]></sql>
    <rollback>
            DROP TRIGGER IF EXISTS stockmgmt_location_after_delete ON location;
            DROP FUNCTION IF EXISTS stockmgmt_location_after_delete();
        </rollback>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-233" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM location_tag WHERE name = 'Main Pharmacy'</sqlCheck>
    </preConditions>
    <comment>Creating the Main Pharmacy location tag</comment>
    <insert tableName="location_tag">
      <column name="name">Main Pharmacy</column>
      <column name="description">Main pharmacy location.</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">89a80c4d-2899-11ed-bdcb-507b9dea1806</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-234" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM location_tag WHERE name = 'Dispensary'</sqlCheck>
    </preConditions>
    <comment>Creating the dispensary location tag</comment>
    <insert tableName="location_tag">
      <column name="name">Dispensary</column>
      <column name="description">A dispensary.</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">fe7c970f-2aba-11ed-ba4a-507b9dea1806</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-235" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM location_tag WHERE name = 'Main Store'</sqlCheck>
    </preConditions>
    <comment>Creating the Main Store location tag</comment>
    <insert tableName="location_tag">
      <column name="name">Main Store</column>
      <column name="description">A location which is the main facility stock holding area.</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">e539ebca-2899-11ed-bdcb-507b9dea1806</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-236" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM location where lower(name) like '%pharmacy%'</sqlCheck>
    </preConditions>
    <comment>Creating the Pharmacy location</comment>
    <sql>
      INSERT INTO location(name,description,creator,date_created,parent_location,uuid)
      SELECT 'Main Pharmacy', null,1,NOW(), (SELECT parent_location from location group by parent_location order by COUNT(*) DESC LIMIT 1),'7f65d926-57d6-4402-ae10-a5b3bcbf7986'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-237" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM location where lower(name) like '%main store%'</sqlCheck>
    </preConditions>
    <comment>Creating the Main Store location</comment>
    <sql>
      INSERT INTO location(name,description,creator,date_created,parent_location,uuid)
      SELECT 'Main Store', null,1,NOW(), (SELECT parent_location from location group by parent_location order by COUNT(*) DESC LIMIT 1),'19dbe2c0-289d-11ed-bdcb-507b9dea1806'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-238" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
          SELECT COUNT(*)
          FROM location_tag_map
          where location_id in (SELECT l.location_id FROM location l where lower(l.name) like '%pharmacy%') AND
          location_tag_id = (SELECT lt.location_tag_id FROM location_tag lt WHERE lt.name = 'Main Pharmacy')</sqlCheck>
    </preConditions>
    <comment>Tagging Pharmacy location as store</comment>
    <sql>
        INSERT INTO location_tag_map(location_id,location_tag_id)
        SELECT l.location_id,  (SELECT lt.location_tag_id FROM location_tag lt WHERE lt.name = 'Main Pharmacy')
        FROM location l
        where lower(l.name) like '%pharmacy%'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-239" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM location_tag_map
        where location_id in (SELECT l.location_id FROM location l where lower(l.name) like '%main store%') AND
        location_tag_id = (SELECT lt.location_tag_id FROM location_tag lt WHERE lt.name = 'Main Store')
      </sqlCheck>
    </preConditions>
    <comment>Tagging Main Store location as main store</comment>
    <sql>
        INSERT INTO location_tag_map(location_id,location_tag_id)
        SELECT l.location_id,  (SELECT lt.location_tag_id FROM location_tag lt WHERE lt.name = 'Main Store')
        FROM location l
        where l.name like '%Main Store%'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-240" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'adjustment'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation type adjustment</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Adjustment</column>
      <column name="operation_type">adjustment</column>
      <column name="description">Physical item quantities that do not match the current system quantity.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="has_destination" valueBoolean="false">
      </column>
      <column name="available_when_reserved" valueBoolean="true">
      </column>
      <column name="acronym">ADJ</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">11111111-1111-1111-1111-111111111111</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-241" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='11111111-1111-1111-1111-111111111111') AND
        location_tag='Main Store'
      </sqlCheck>
    </preConditions>
    <comment>Limiting adjustment stock from the Main Store</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',1, 0,1,now(), '019f2d4b-2a56-11ed-9cab-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='11111111-1111-1111-1111-111111111111'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-242" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='11111111-1111-1111-1111-111111111111') AND
        location_tag='Main Pharmacy'
      </sqlCheck>
    </preConditions>
    <comment>Limiting adjustment stock from the Main Pharmacy</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Pharmacy',1, 0,1,now(), 'f958ad0a-2a55-11ed-9cab-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='11111111-1111-1111-1111-111111111111'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-243" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='11111111-1111-1111-1111-111111111111') AND
        location_tag='Dispensary'
      </sqlCheck>
    </preConditions>
    <comment>Limiting adjustment stock from the Dispensary</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Dispensary',1, 0,1,now(), '7228d114-2abc-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='11111111-1111-1111-1111-111111111111'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-244" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'disposed'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation type disposed</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Disposal</column>
      <column name="operation_type">disposed</column>
      <column name="description">Item stock quantities that have expired and must be removed from circulation.
            </column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="has_destination" valueBoolean="false">
      </column>
      <column name="available_when_reserved" valueBoolean="true">
      </column>
      <column name="acronym">DIS</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">22222222-2222-2222-2222-222222222222</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-245" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='22222222-2222-2222-2222-222222222222') AND
        location_tag='Main Store'
      </sqlCheck>
    </preConditions>
    <comment>Limiting disposing stock from the main store only</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',1, 0,1,now(), '12de41c9-28a1-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='22222222-2222-2222-2222-222222222222'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-246" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
      SELECT COUNT(*)
      FROM stockmgmt_operation_type_location_scope sotls
      WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='22222222-2222-2222-2222-222222222222') AND
      location_tag='Main Pharmacy'
    </sqlCheck>
    </preConditions>
    <comment>Limiting adjustment stock from the Main Pharmacy</comment>
    <sql>
    INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
    SELECT sot.stock_operation_type_id,'Main Pharmacy',1, 0,1,now(), '8bee3005-2ae6-11ed-ba4a-507b9dea1806'
    FROM stockmgmt_stock_operation_type sot
    WHERE uuid='22222222-2222-2222-2222-222222222222'
  </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-247" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='22222222-2222-2222-2222-222222222222') AND
        location_tag='Dispensary'
      </sqlCheck>
    </preConditions>
    <comment>Limiting adjustment stock from the Dispensary</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Dispensary',1, 0,1,now(), '83fbf8ca-2ae6-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='22222222-2222-2222-2222-222222222222'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-248" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'transferout'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation type transferout</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Transfer Out</column>
      <column name="operation_type">transferout</column>
      <column name="description">Items that are distributed to other outside destination.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="has_destination" valueBoolean="true">
      </column>
      <column name="destination_type">Other</column>
      <column name="available_when_reserved" valueBoolean="true">
      </column>
      <column name="acronym">TFO</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">33333333-3333-3333-3333-333333333333</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-249" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='33333333-3333-3333-3333-333333333333') AND
        location_tag='Main Store'
      </sqlCheck>
    </preConditions>
    <comment>Limiting transfering to outside destination from main store only</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',1, 0,1,now(), '5b341a26-28a2-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='33333333-3333-3333-3333-333333333333'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-250" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'receipt'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation type receipt</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Receipt</column>
      <column name="operation_type">receipt</column>
      <column name="description">Items that are added into the inventory system from an outside provider.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Other</column>
      <column name="destination_type">Location</column>
      <column name="has_destination" valueBoolean="true">
      </column>
      <column name="available_when_reserved" valueBoolean="false">
      </column>
      <column name="acronym">RCPT</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">44444444-4444-4444-4444-444444444444</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-251" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='44444444-4444-4444-4444-444444444444') AND
        location_tag='Main Store'
      </sqlCheck>
    </preConditions>
    <comment>Limiting receipt of stock main store only</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',0, 1,1,now(), '01c9285a-28a3-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='44444444-4444-4444-4444-444444444444'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-252" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'return'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation type return</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Return</column>
      <column name="operation_type">return</column>
      <column name="description">Items that are returned to the main store from other stock holding areas.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="destination_type">Location</column>
      <column name="has_destination" valueBoolean="true">
      </column>
      <column name="available_when_reserved" valueBoolean="true">
      </column>
      <column name="acronym">RTU</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">55555555-5555-5555-5555-555555555555</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-253" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='55555555-5555-5555-5555-555555555555') AND
        location_tag='Main Pharmacy'  AND is_source=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting initiating of return of stock from Main Pharmacy</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Pharmacy',1, 0,1,now(), '2c5772e7-28a4-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='55555555-5555-5555-5555-555555555555'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-254" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='55555555-5555-5555-5555-555555555555') AND
        location_tag='Dispensary'  AND is_source=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting initiating of return of stock from dispensary</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Dispensary',1, 0,1,now(), '6e26757a-2abe-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='55555555-5555-5555-5555-555555555555'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-255" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='55555555-5555-5555-5555-555555555555') AND
        location_tag='Main Store' AND is_destination=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting the destination of returned stock to main store only</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',0, 1,1,now(), '27ff4a05-28a4-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='55555555-5555-5555-5555-555555555555'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-256" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'stockissue'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation type stockissue</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Stock Issue</column>
      <column name="operation_type">stockissue</column>
      <column name="description">Items that are transferred between two locations.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="destination_type">Location</column>
      <column name="has_destination" valueBoolean="true">
      </column>
      <column name="available_when_reserved" valueBoolean="true">
      </column>
      <column name="acronym">SIS</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">66666666-6666-6666-6666-666666666666</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-257" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='66666666-6666-6666-6666-666666666666') AND
        location_tag='Main Pharmacy'  AND is_destination=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting the destination of issued stock to Main Pharmacy</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Pharmacy',0, 1,1,now(), '20fac1fa-28a4-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='66666666-6666-6666-6666-666666666666'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-258" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='66666666-6666-6666-6666-666666666666') AND
        location_tag='Dispensary'  AND is_destination=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting the destination of issued stock to Dispensary</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Dispensary',0, 1,1,now(), '11ebab13-2abf-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='66666666-6666-6666-6666-666666666666'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-259" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='66666666-6666-6666-6666-666666666666') AND
        location_tag='Main Store' AND is_source=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting the issuing of stock from main store only</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',1, 0,1,now(), '1c984ba0-28a4-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='66666666-6666-6666-6666-666666666666'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-260" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'requisition'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation types</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Requisition</column>
      <column name="operation_type">requisition</column>
      <column name="description">Request for items from another location.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="destination_type">Location</column>
      <column name="has_destination" valueBoolean="true">
      </column>
      <column name="available_when_reserved" valueBoolean="false">
      </column>
      <column name="acronym">REQ</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">77777777-7777-7777-7777-777777777777</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-261" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='77777777-7777-7777-7777-777777777777') AND
        location_tag='Main Pharmacy'  AND is_source=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting initiating of requisition of stock from Main Pharmacy</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Pharmacy',1, 0,1,now(), '161ccea9-28a4-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='77777777-7777-7777-7777-777777777777'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-262" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='77777777-7777-7777-7777-777777777777') AND
        location_tag='Dispensary'  AND is_source=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting initiating of requisition of stock from Dispensary</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Dispensary',1, 0,1,now(), 'dfba06ad-2abe-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='77777777-7777-7777-7777-777777777777'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-263" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='77777777-7777-7777-7777-777777777777') AND
        location_tag='Main Store' AND is_destination=1
      </sqlCheck>
    </preConditions>
    <comment>Limiting the destination of requisition of stock to main store only</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',0, 1,1,now(), '11ba3575-28a4-11ed-bdcb-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='77777777-7777-7777-7777-777777777777'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-264" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
                'stocktake'
            </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation types</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Stock Take</column>
      <column name="operation_type">stocktake</column>
      <column name="description">Physical verification of item quantities.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="has_destination" valueBoolean="false">
      </column>
      <column name="available_when_reserved" valueBoolean="true">
      </column>
      <column name="acronym">STK</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">88888888-8888-8888-8888-888888888888</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-265" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='88888888-8888-8888-8888-888888888888') AND
        location_tag='Main Store'
      </sqlCheck>
    </preConditions>
    <comment>Limiting stocktake stock from the Main Store</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',1, 0,1,now(), '90b9f544-2abf-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='88888888-8888-8888-8888-888888888888'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-266" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='88888888-8888-8888-8888-888888888888') AND
        location_tag='Main Pharmacy'
      </sqlCheck>
    </preConditions>
    <comment>Limiting stock take stock from the Main Pharmacy</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Pharmacy',1, 0,1,now(), '8ab5bb1d-2abf-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='88888888-8888-8888-8888-888888888888'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-267" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='88888888-8888-8888-8888-888888888888') AND
        location_tag='Dispensary'
      </sqlCheck>
    </preConditions>
    <comment>Limiting stock take stock from the Dispensary</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Dispensary',1, 0,1,now(), '86fad5b3-2abf-11ed-ba4a-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='88888888-8888-8888-8888-888888888888'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-268" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM stockmgmt_stock_operation_type WHERE operation_type =
        'initial'
      </sqlCheck>
    </preConditions>
    <comment>Creating the stock operation type initial</comment>
    <insert tableName="stockmgmt_stock_operation_type">
      <column name="name">Opening Stock</column>
      <column name="operation_type">initial</column>
      <column name="description">Initial physical item quantities.</column>
      <column name="has_source" valueBoolean="true">
      </column>
      <column name="source_type">Location</column>
      <column name="has_destination" valueBoolean="false">
      </column>
      <column name="available_when_reserved" valueBoolean="false">
      </column>
      <column name="acronym">IST</column>
      <column name="creator">1</column>
      <column name="date_created">2022-07-31</column>
      <column name="uuid">99999999-9999-9999-9999-999999999999</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-269" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='99999999-9999-9999-9999-999999999999') AND
        location_tag='Main Store'
      </sqlCheck>
    </preConditions>
    <comment>Limiting initial stock from the Main Store</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Store',1, 0,1,now(), '886b6f2d-2e90-11ed-a5a0-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='99999999-9999-9999-9999-999999999999'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-270" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='99999999-9999-9999-9999-999999999999') AND
        location_tag='Main Pharmacy'
      </sqlCheck>
    </preConditions>
    <comment>Limiting initial stock from the Main Pharmacy</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Main Pharmacy',1, 0,1,now(), '99e64f69-2e90-11ed-a5a0-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='99999999-9999-9999-9999-999999999999'
    </sql>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-271" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*)
        FROM stockmgmt_operation_type_location_scope sotls
        WHERE sotls.stock_operation_type_id = (SELECT sot.stock_operation_type_id FROM stockmgmt_stock_operation_type sot WHERE uuid='99999999-9999-9999-9999-999999999999') AND
        location_tag='Dispensary'
      </sqlCheck>
    </preConditions>
    <comment>Limiting initial stock from the Dispensary</comment>
    <sql>
      INSERT INTO stockmgmt_operation_type_location_scope(stock_operation_type_id,location_tag,is_source,is_destination,creator,date_created,uuid)
      SELECT sot.stock_operation_type_id,'Dispensary',1, 0,1,now(), 'a24c5c90-2e90-11ed-a5a0-507b9dea1806'
      FROM stockmgmt_stock_operation_type sot
      WHERE uuid='99999999-9999-9999-9999-999999999999'
    </sql>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-272">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_order_item" />
      </not>
    </preConditions>
    <comment>
      Creating the stockmgmt_order_item table
    </comment>
    <createTable tableName="stockmgmt_order_item">
      <column autoIncrement="true" name="order_item_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="order_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="stock_item_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="stock_item_packaging_uom_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="created_from" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="fulfilment_location_id" type="INT">
        <constraints nullable="false" />
      </column>
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="date_voided" type="DATETIME" />
      <column name="voided_by" type="INT" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-273">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_changed_by_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-274">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_creator_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-275">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_stock_item_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_stock_item_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="stock_item_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-276">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_voided_by_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-277">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_order_item" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-278">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_packaging_uom_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_packaging_uom_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="stock_item_packaging_uom_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-279">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_order_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_order_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="order_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-280">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_created_from_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_created_from_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="created_from" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-281">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_order_item_fulfilment_loc_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_order_item_fulfilment_loc_fk" tableName="stockmgmt_order_item" unique="false">
      <column name="fulfilment_location_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-282">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-283">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-284">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_stock_item_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_id" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_stock_item_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_id" referencedTableName="stockmgmt_stock_item" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-285">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-286">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_packaging_uom_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="stock_item_packaging_uom_id" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_packaging_uom_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="stock_item_packaging_uom_id" referencedTableName="stockmgmt_stock_item_packaging_uom" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-287">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_order_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="order_id" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_order_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="order_id" referencedTableName="orders" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-288">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_created_from_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="created_from" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_created_from_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="location_id" referencedTableName="location" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-289">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_order_item_fulfilment_loc_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="fulfilment_location_id" baseTableName="stockmgmt_order_item" constraintName="stockmgmt_order_item_fulfilment_loc_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="location_id" referencedTableName="location" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-290">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_item"/>
      <not>
        <columnExists tableName="stockmgmt_stock_item" columnName="category_id"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_item">
      <column name="category_id" type="int"/>
    </addColumn>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-291">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_category_id_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_category_id_fk" tableName="stockmgmt_stock_item" unique="false">
      <column name="category_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-292">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_stock_item_category_id_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="category_id" baseTableName="stockmgmt_stock_item" constraintName="stockmgmt_stock_item_category_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="concept_id" referencedTableName="concept" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-293">
    <preConditions onFail="MARK_RAN">
        <indexExists indexName="stockmgmt_stock_item_transaction_itemsearch_fk" />
    </preConditions>
    <dropIndex tableName="stockmgmt_stock_item_transaction" indexName="stockmgmt_stock_item_transaction_itemsearch_fk" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-294">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_transaction_itemsearch_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_transaction_itemsearch_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="party_id" />
      <column name="stock_item_id" />
      <column name="stock_batch_id" />
      <column name="date_created" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-295">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_item_txn_itemsearch_date_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_item_txn_itemsearch_date_fk" tableName="stockmgmt_stock_item_transaction" unique="false">
      <column name="party_id" />
      <column name="stock_item_id" />
      <column name="date_created" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-296">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_rule"/>
      <columnExists tableName="stockmgmt_stock_rule" columnName="alert_priviledge"/>
    </preConditions>
    <dropColumn tableName="stockmgmt_stock_rule" columnName="alert_priviledge" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-297">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_rule"/>
      <columnExists tableName="stockmgmt_stock_rule" columnName="mail_priviledge"/>
    </preConditions>
    <dropColumn tableName="stockmgmt_stock_rule" columnName="mail_priviledge" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-298">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_rule"/>
      <not>
        <columnExists tableName="stockmgmt_stock_rule" columnName="alert_role"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_rule">
      <column name="alert_role" type="VARCHAR(50)"/>
    </addColumn>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-299">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_rule"/>
      <not>
        <columnExists tableName="stockmgmt_stock_rule" columnName="mail_role"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_rule">
      <column name="mail_role" type="VARCHAR(50)"/>
    </addColumn>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-300">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_rule"/>
      <not>
        <columnExists tableName="stockmgmt_stock_rule" columnName="last_action_date"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_rule">
      <column name="last_action_date" type="DATETIME"/>
    </addColumn>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-301">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_rule"/>
      <not>
        <columnExists tableName="stockmgmt_stock_rule" columnName="enable_descendants"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_rule">
      <column defaultValueBoolean="false" name="enable_descendants" type="BIT">
        <constraints nullable="false" />
      </column>
    </addColumn>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-302">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_rule"/>
      <not>
        <columnExists tableName="stockmgmt_stock_rule" columnName="next_action_date"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_rule">
      <column name="next_action_date" type="DATETIME"/>
    </addColumn>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-303">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_batch"/>
      <not>
        <columnExists tableName="stockmgmt_stock_batch" columnName="expiry_notification_date"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_batch">
      <column name="expiry_notification_date" type="DATETIME"/>
    </addColumn>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-304" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM notification_template WHERE uuid = '7a23df8e-53c7-11ed-b2e9-00155dc74b5a'</sqlCheck>
    </preConditions>
    <comment>Creating the stock quantity below threshold email template</comment>
    <insert tableName="notification_template">
      <column name="name">STOCK_MGMT_QTY_BELOW_THRESHOLD</column>
      <column name="subject">Stock item quantity reached threshold</column>
      <column name="uuid">7a23df8e-53c7-11ed-b2e9-00155dc74b5a</column>
      <column name="template">&lt;html&gt;
        &lt;body style="font-size:13px;color:#333333;font-family:arial,sans-serif;"&gt;
        Dear &lt;b&gt;%RECPT_NAME%&lt;/b&gt;,
        &lt;br/&gt;
        &lt;br/&gt;
        This is to notify you that the following stock items have their quantities at or below the set threshold.
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;table style='text-align:left;white-space:nowrap;border:solid 1px grey;font-size:13px;' cellpadding='2' cellspacing='0'&gt;
        &lt;tr&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;'&gt;Location&lt;/td&gt;
        &lt;td&gt;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;'&gt;Stock Item&lt;/td&gt;
        &lt;td&gt;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;'&gt;Quantity Threshold&lt;/td&gt;
        &lt;td&gt;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;Current Quantity&lt;/td&gt;
        &lt;/tr&gt;
        %STOCK_ITEMS%
        &lt;/table&gt;
        %MORE_INFO%
        &lt;br&gt;
        This email was sent from the automated system that cannot accept incoming email. Do not reply to this message.
        &lt;br&gt;
        &lt;br&gt;
        &lt;b&gt;%CENTER_NAME%&lt;/b&gt;
        &lt;/body&gt;
        &lt;/html&gt;</column>
    </insert>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-305">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_item"/>
      <not>
        <columnExists tableName="stockmgmt_stock_item" columnName="expiry_notice"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_item">
      <column name="expiry_notice" type="INT"/>
    </addColumn>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-306" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="1">SELECT COUNT(*) FROM notification_template WHERE uuid = '7a23df8e-53c7-11ed-b2e9-00155dc74b5a'</sqlCheck>
    </preConditions>
    <comment>Updating the stock quantity below threshold email template</comment>
    <update tableName="notification_template">
      <column name="template">&lt;html&gt;
        &lt;body style="font-size:13px;color:#333333;font-family:arial,sans-serif;"&gt;
        Dear &lt;b&gt;%RECPT_NAME%&lt;/b&gt;,
        &lt;br/&gt;
        &lt;br/&gt;
        This is to notify you that the following stock items have their quantities at or below the set threshold.
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;table style='text-align:left;white-space:nowrap;border:solid 1px grey;font-size:13px;' border='0' cellpadding='2' cellspacing='0'&gt;
        &lt;tr&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;'&gt;Location&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;'&gt;Stock Item&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;'&gt;Quantity Threshold&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;Current Quantity&lt;/td&gt;
        &lt;/tr&gt;
        %STOCK_ITEMS%
        &lt;/table&gt;
        %MORE_INFO%
        &lt;br&gt;
        This email was sent from the automated system that cannot accept incoming email. Do not reply to this message.
        &lt;br&gt;
        &lt;br&gt;
        &lt;b&gt;%CENTER_NAME%&lt;/b&gt;
        &lt;/body&gt;
        &lt;/html&gt;</column>
      <where>name = 'STOCK_MGMT_QTY_BELOW_THRESHOLD'</where>
    </update>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-307" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM notification_template WHERE uuid = 'ff9f1cb5-576a-11ed-a495-00155dc81c72'</sqlCheck>
    </preConditions>
    <comment>Creating the stock item expiry email template</comment>
    <insert tableName="notification_template">
      <column name="name">STOCK_MGMT_BATCH_EXPIRING</column>
      <column name="subject">Stock item batch expiring</column>
      <column name="uuid">ff9f1cb5-576a-11ed-a495-00155dc81c72</column>
      <column name="template">&lt;html&gt;
        &lt;body style='font-size:13px;color:#333333;font-family:arial,sans-serif;'&gt;
        %RECPT_NAME%,
        &lt;br/&gt;
        &lt;br/&gt;
        This is to notify you that the following stock items with batch information below are expiring soon.
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;table style='text-align:left;white-space:nowrap;border:solid 1px grey;font-size:13px;' cellpadding='2' cellspacing='0' border='0'&gt;
        &lt;tr&gt;
        &lt;td colspan="3" style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;'&gt;Stock Item&lt;/td&gt;

        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;text-align:right;'&gt;Batch&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;border-right:solid 1px grey;text-align:right;'&gt;Quantity&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt;
        &lt;td style='padding: 0.5rem;font-weight:bold;border-bottom:solid 1px grey;text-align:right;'&gt;Expiry Date&lt;/td&gt;
        &lt;/tr&gt;
        %STOCK_ITEMS%
        &lt;/table&gt;
        %MORE_INFO%
        &lt;br&gt;
        This email was sent from the automated system that cannot accept incoming email. Do not reply to this message.
        &lt;br&gt;
        &lt;br&gt;
        &lt;b&gt;%CENTER_NAME%&lt;/b&gt;
        &lt;/body&gt;
        &lt;/html&gt;</column>
    </insert>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-308">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_stock_batch_expiration_ix" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_stock_batch_expiration_ix" tableName="stockmgmt_stock_batch" unique="false">
      <column name="expiration" />
      <column name="expiry_notification_date" />
      <column name="voided" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-309">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*) FROM scheduler_task_config
        WHERE schedulable_class = 'org.openmrs.module.stockmanagement.api.jobs.StockRuleEvaluationJob'
      </sqlCheck>
    </preConditions>
    <sql>DELETE FROM scheduler_task_config where uuid='5a0b041a-5796-11ed-a495-00155dc81c72'</sql>
    <comment>Inserting Stock Rules Evaluation Job into 'schedule_task_config' table</comment>
    <insert tableName="scheduler_task_config">
      <column name="name" value="Stock Rules Evaluation Job" />
      <column name="description" value="Checks the stock rules against the item quantity and notifies when quantity is at or below threshold" />
      <column name="schedulable_class" value="org.openmrs.module.stockmanagement.api.jobs.StockRuleEvaluationJob" />
      <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss" />
      <column name="start_time" valueDate="2022-10-01T00:59:59" />
      <column name="repeat_interval" value="86400" />
      <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
      <column name="created_by" value="1" />
      <column name="start_on_startup" value="0"/>
      <column name="started" value="1"/>
      <column name="uuid" value="5a0b041a-5796-11ed-a495-00155dc81c72" />
    </insert>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-310">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*) FROM scheduler_task_config
        WHERE schedulable_class = 'org.openmrs.module.stockmanagement.api.jobs.StockBatchExpiryJob'
      </sqlCheck>
    </preConditions>
    <sql>DELETE FROM scheduler_task_config where uuid='911fc382-5797-11ed-a495-00155dc81c72'</sql>
    <comment>Inserting Stock Batch Expiry Job into 'schedule_task_config' table</comment>
    <insert tableName="scheduler_task_config">
      <column name="name" value="Stock Batch Expiry Job" />
      <column name="description" value="Checks for stock items expiring soon and notifies inventory manager and clerk" />
      <column name="schedulable_class" value="org.openmrs.module.stockmanagement.api.jobs.StockBatchExpiryJob" />
      <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss" />
      <column name="start_time" valueDate="2022-10-01T00:00:00" />
      <column name="repeat_interval" value="86400" />
      <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
      <column name="created_by" value="1" />
      <column name="start_on_startup" value="0"/>
      <column name="started" value="1"/>
      <column name="uuid" value="911fc382-5797-11ed-a495-00155dc81c72" />
    </insert>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-311">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_operation_type"/>
      <not>
        <columnExists tableName="stockmgmt_stock_operation_type" columnName="notify_submitted"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_operation_type">
      <column defaultValueBoolean="false" name="notify_submitted" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="notify_approved" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="notify_completed" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="notify_cancelled" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="notify_rejected" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="notify_returned" type="BIT">
        <constraints nullable="false" />
      </column>
      <column defaultValueBoolean="false" name="notify_dispatched" type="BIT">
        <constraints nullable="false" />
      </column>
    </addColumn>
    <update tableName="stockmgmt_stock_operation_type">
      <column name="notify_submitted" valueBoolean="true" />
      <column name="notify_approved" valueBoolean="true" />
      <column name="notify_completed" valueBoolean="true" />
      <where>operation_type in ('receipt', 'transferout')</where>
    </update>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-312" author="dev">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">SELECT COUNT(*) FROM notification_template WHERE uuid = '59edf349-5b76-11ed-8829-00155d8315fc'</sqlCheck>
    </preConditions>
    <comment>Creating the stock operation notification template</comment>
    <insert tableName="notification_template">
      <column name="name">STOCK_MGMT_OPERATION_ACTION</column>
      <column name="subject">%LOCATION%: Stock Operation %OPERATION_TYPE% %OPERATION_REF% %OPERATION_ACTION%</column>
      <column name="uuid">59edf349-5b76-11ed-8829-00155d8315fc</column>
      <column name="template">&lt;html&gt;
        &lt;body style='font-size:13px;color:#333333;font-family:arial,sans-serif;'&gt;
        Hello,
        &lt;br/&gt;
        &lt;br/&gt;
        This is to notify you that &lt;b&gt;%ACTION_BY%&lt;/b&gt; has %OPERATION_ACTION% the stock operation &lt;b&gt;%OPERATION_TYPE% %OPERATION_REF%&lt;/b&gt;.
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;table style='text-align:left;white-space:nowrap;border:0;font-size:13px;' cellpadding='2' cellspacing='0' border='0'&gt;
        %OPERATION_BASIC_INFO%
        &lt;/table&gt;
        &lt;br/&gt;
        Access the medical records system to view more details about the transaction.
        &lt;br/&gt;
        &lt;br/&gt;
        This email was sent from the automated system that cannot accept incoming email. Do not reply to this message.
        &lt;br&gt;
        &lt;br&gt;
        &lt;b&gt;%CENTER_NAME%&lt;/b&gt;
        &lt;/body&gt;
        &lt;/html&gt;</column>
    </insert>
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-313" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_batch_job" />
      </not>
    </preConditions>
    <comment>
      Creating the stockmgmt_batch_job table
    </comment>
    <createTable tableName="stockmgmt_batch_job">
      <column autoIncrement="true" name="batch_job_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="batch_job_type" type="VARCHAR(50)">
        <constraints nullable="false" />
      </column>
      <column name="status" type="VARCHAR(50)">
        <constraints nullable="false" />
      </column>
      <column name="description" type="VARCHAR(255)">
        <constraints nullable="false" />
      </column>
      <column name="start_time" type="DATETIME" />
      <column name="end_time" type="DATETIME" />
      <column name="expiration" type="DATETIME" />
      <column name="parameters" type="VARCHAR(5000)">
        <constraints nullable="false" />
      </column>
      <column name="privilege_scope" type="VARCHAR(255)" />
      <column name="location_scope" type="INT" />
      <column name="execution_state" type="VARCHAR(5000)" />
      <column name="cancelled_by" type="INT" />
      <column name="cancelled_date" type="DATETIME" />
      <column name="cancel_reason" type="VARCHAR(500)" />
      <column name="exit_message" type="VARCHAR(2500)" />
      <column name="completed_date" type="DATETIME" />
      <column name="output_artifact_size" type="BIGINT" />
      <column name="output_artifact_file_ext" type="VARCHAR(10)" />
      <column name="output_artifact_viewable" type="BIT" />
      <column defaultValueNumeric="0" name="creator" type="INT">
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="changed_by" type="INT" />
      <column name="date_changed" type="DATETIME" />
      <column defaultValueBoolean="false" name="voided" type="BIT">
        <constraints nullable="false" />
      </column>
      <column name="date_voided" type="DATETIME" />
      <column name="voided_by" type="INT" />
      <column name="void_reason" type="VARCHAR(255)" />
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-314">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_batch_job_cancelled_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_batch_job_cancelled_by_fk" tableName="stockmgmt_batch_job" unique="false">
      <column name="cancelled_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-315">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_batch_job_changed_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_batch_job_changed_by_fk" tableName="stockmgmt_batch_job" unique="false">
      <column name="changed_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-316">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_batch_job_creator_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_batch_job_creator_fk" tableName="stockmgmt_batch_job" unique="false">
      <column name="creator" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-317">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_batch_job_voided_by_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_batch_job_voided_by_fk" tableName="stockmgmt_batch_job" unique="false">
      <column name="voided_by" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-318">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_batch_job" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-319">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_batch_job_cancelled_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="cancelled_by" baseTableName="stockmgmt_batch_job" constraintName="stockmgmt_batch_job_cancelled_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-320">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_batch_job_changed_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="stockmgmt_batch_job" constraintName="stockmgmt_batch_job_changed_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-321">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_batch_job_creator_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="creator" baseTableName="stockmgmt_batch_job" constraintName="stockmgmt_batch_job_creator_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-322">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_batch_job_voided_by_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="voided_by" baseTableName="stockmgmt_batch_job" constraintName="stockmgmt_batch_job_voided_by_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-323">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_batch_job_location_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_batch_job_location_fk" tableName="stockmgmt_batch_job" unique="false">
      <column name="location_scope" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-324">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_batch_job_location_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="location_scope" baseTableName="stockmgmt_batch_job" constraintName="stockmgmt_batch_job_location_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="location_id" referencedTableName="location" />
  </changeSet>
  <changeSet id="stockmanagement-1758855877841-325" author="dev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="stockmgmt_batch_job_owner" />
      </not>
    </preConditions>
    <comment>
      Creating the stockmgmt_batch_job_owner table
    </comment>
    <createTable tableName="stockmgmt_batch_job_owner">
      <column autoIncrement="true" name="batch_job_owner_id" type="INT">
        <constraints nullable="false" primaryKey="true" />
      </column>
      <column name="batch_job_id" type="INT" >
        <constraints nullable="false" />
      </column>
      <column name="owner" type="INT" >
        <constraints nullable="false" />
      </column>
      <column name="date_created" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="uuid" type="CHAR(38)">
        <constraints nullable="false" unique="true" />
      </column>
    </createTable>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-326">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="uuid" />
      </not>
    </preConditions>
    <createIndex indexName="uuid" tableName="stockmgmt_batch_job_owner" unique="true">
      <column name="uuid" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-327">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_batch_job_owner_batch_job_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_batch_job_owner_batch_job_fk" tableName="stockmgmt_batch_job_owner" unique="false">
      <column name="batch_job_id" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-328">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_batch_job_owner_batch_job_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="batch_job_id" baseTableName="stockmgmt_batch_job_owner" constraintName="stockmgmt_batch_job_owner_batch_job_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="batch_job_id" referencedTableName="stockmgmt_batch_job" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-329">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists indexName="stockmgmt_batch_job_owner_owner_fk" />
      </not>
    </preConditions>
    <createIndex indexName="stockmgmt_batch_job_owner_owner_fk" tableName="stockmgmt_batch_job_owner" unique="false">
      <column name="owner" />
    </createIndex>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-330">
    <preConditions onFail="MARK_RAN">
      <not>
        <foreignKeyConstraintExists foreignKeyName="stockmgmt_batch_job_owner_owner_fk" />
      </not>
    </preConditions>
    <addForeignKeyConstraint baseColumnNames="owner" baseTableName="stockmgmt_batch_job_owner" constraintName="stockmgmt_batch_job_owner_owner_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="user_id" referencedTableName="users" />
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-331">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*) FROM scheduler_task_config
        WHERE schedulable_class = 'org.openmrs.module.stockmanagement.api.jobs.AsyncTasksBatchJob'
      </sqlCheck>
    </preConditions>
    <sql>DELETE FROM scheduler_task_config where uuid='73eb1d31-6e5e-11ed-9a5b-00155db5005a'</sql>
    <comment>Inserting Asynchronous Report Generation And Batch Jobs into 'schedule_task_config' table</comment>
    <insert tableName="scheduler_task_config">
      <column name="name" value="Asynchronous Report Generation And Batch Jobs" />
      <column name="description" value="Runs report generation and batch jobs asynchronously" />
      <column name="schedulable_class" value="org.openmrs.module.stockmanagement.api.jobs.AsyncTasksBatchJob" />
      <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss" />
      <column name="start_time" valueDate="2022-10-01T00:59:59" />
      <column name="repeat_interval" value="60" />
      <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
      <column name="created_by" value="1" />
      <column name="start_on_startup" value="1"/>
      <column name="started" value="1"/>
      <column name="uuid" value="73eb1d31-6e5e-11ed-9a5b-00155db5005a" />
    </insert>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-332">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_operation_type"/>
      <not>
        <columnExists tableName="stockmgmt_stock_operation_type" columnName="allow_expired_batch_numbers"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_operation_type">
      <column defaultValueBoolean="false" name="allow_expired_batch_numbers" type="BIT">
        <constraints nullable="false" />
      </column>
    </addColumn>
    <update tableName="stockmgmt_stock_operation_type">
      <column name="allow_expired_batch_numbers" valueBoolean="true" />
      <where>operation_type in ('disposed')</where>
    </update>
  </changeSet>
  <changeSet author="dev" id="stockmanagement-1758855877841-333">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_operation_type"/>
      <not>
        <columnExists tableName="stockmgmt_stock_operation_type" columnName="allow_batch_info_update"/>
      </not>
    </preConditions>
    <addColumn tableName="stockmgmt_stock_operation_type">
      <column defaultValueBoolean="false" name="allow_batch_info_update" type="BIT">
        <constraints nullable="false" />
      </column>
    </addColumn>
    <update tableName="stockmgmt_stock_operation_type">
      <column name="allow_batch_info_update" valueBoolean="true" />
      <where>operation_type in ('receipt', 'initial')</where>
    </update>
  </changeSet>
    <changeSet id="stockmanagement-06-12-0700" author="slubwama">
      <preConditions onFail="MARK_RAN">
        <not>
          <tableExists tableName="stockmgmt_stock_item_reference" />
        </not>
      </preConditions>
      <comment>
        Creating the stockmgmt_batch_job_owner table
      </comment>
      <createTable tableName="stockmgmt_stock_item_reference">
        <column name="stock_item_reference_id" type="int" autoIncrement="true">
          <constraints primaryKey="true" nullable="false"/>
        </column>
        <column name="stock_source_id" type="int">
          <constraints nullable="false"/>
        </column>
        <column name="stock_item_id" type="int">
          <constraints nullable="false"/>
        </column>
        <column name="stock_reference_code" type="varchar(255)">
          <constraints nullable="false"/>
        </column>
        <column name="creator" type="int">
          <constraints nullable="false"/>
        </column>
        <column name="date_created" type="date">
          <constraints nullable="true"/>
        </column>
        <column name="changed_by" type="int">
          <constraints nullable="true"/>
        </column>
        <column name="date_changed" type="date">
          <constraints nullable="true"/>
        </column>
        <column name="voided" type="tinyint(1)">
          <constraints nullable="true"/>
        </column>
        <column name="date_voided" type="date">
          <constraints nullable="true"/>
        </column>
        <column name="voided_by" type="int">
          <constraints nullable="true"/>
        </column>
        <column name="void_reason" type="varchar(255)">
          <constraints nullable="true"/>
        </column>
      </createTable>

      <addForeignKeyConstraint baseTableName="stockmgmt_stock_item_reference"
                               baseColumnNames="stock_item_id"
                               referencedTableName="stockmgmt_stock_item"
                               referencedColumnNames="stock_item_id"
                               constraintName="stock_item_reference_stock_item_stock_item_id_fk"/>

      <addForeignKeyConstraint baseTableName="stockmgmt_stock_item_reference"
                               baseColumnNames="stock_source_id"
                               referencedTableName="stockmgmt_stock_source"
                               referencedColumnNames="stock_source_id"
                               constraintName="stock_item_reference_stock_source_stock_source_id_fk"/>

      <addForeignKeyConstraint baseTableName="stockmgmt_stock_item_reference"
                               baseColumnNames="changed_by"
                               referencedTableName="users"
                               referencedColumnNames="user_id"
                               constraintName="stock_item_reference_users_changed_by_id_fk"/>

      <addForeignKeyConstraint baseTableName="stockmgmt_stock_item_reference"
                               baseColumnNames="creator"
                               referencedTableName="users"
                               referencedColumnNames="user_id"
                               constraintName="stock_item_reference_users_creator_id_fk"/>

      <addForeignKeyConstraint baseTableName="stockmgmt_stock_item_reference"
                               baseColumnNames="voided_by"
                               referencedTableName="users"
                               referencedColumnNames="user_id"
                               constraintName="stock_item_reference_users_voided_by_id_fk"/>
    </changeSet>

  <changeSet author="slubwama" id="stockmanagement-23-12-0700">
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="stockmgmt_stock_item_reference" />
      <sqlCheck expectedResult="0">
        SELECT COUNT(*) FROM information_schema.table_constraints WHERE constraint_type = 'UNIQUE' AND table_name = 'stockmgmt_stock_item_reference' AND constraint_name = 'stockmgmt_stock_item_reference_source_code_pk';
      </sqlCheck>
   </preConditions>
    <comment>
      adding constraint unique to column reference_code and stock_source_id
    </comment>
    <addUniqueConstraint
            columnNames="stock_reference_code, stock_source_id"
            constraintName="stockmgmt_stock_item_reference_source_code_pk"
            tableName="stockmgmt_stock_item"/>
  </changeSet>
</databaseChangeLog>